
# **Deploying a Serverless Web Form with AWS Lambda, DynamoDB & Terraform**
This document provides a complete guide to building a **serverless web application** using **AWS Lambda**, **API Gateway (optional)**, **DynamoDB**, and **Terraform** for infrastructure automation.

## **üìå Requirements**
Before starting, ensure you have the following:
- **AWS Account** with IAM permissions for Lambda, DynamoDB, and S3.
- **AWS CloudShell or EC2 Instance** to execute Terraform commands.

---

## **1Ô∏è‚É£ How to Set Up AWS CloudShell**
### **What is AWS CloudShell?**
AWS CloudShell is a browser-based shell that provides CLI access to AWS services.

### **How to Open AWS CloudShell**
1. Go to **AWS Management Console** ‚Üí **Search for "CloudShell"**.
2. Click **"Launch CloudShell"**.
3. A terminal window will open with CLI access.

---

## **2Ô∏è‚É£ Install Terraform in AWS CloudShell**
AWS CloudShell **does not have Terraform pre-installed**, so install it using:

```sh
sudo yum install -y unzip
curl -o terraform.zip https://releases.hashicorp.com/terraform/1.5.0/terraform_1.5.0_linux_amd64.zip
unzip terraform.zip
sudo mv terraform /usr/local/bin/
terraform --version  # Verify installation
```

---

## **3Ô∏è‚É£ Create Terraform Configuration**
### **What is Terraform?**
Terraform is an Infrastructure-as-Code (IaC) tool that automates AWS resource creation.

### **How to Create Terraform Files**
Run the following to create a project directory:

```sh
mkdir lambda_web_form && cd lambda_web_form
```

Create Terraform files:

```sh
touch main.tf
nano main.tf
```

Paste the following **Terraform configuration**:

```hcl
provider "aws" {
  region = "us-east-1"
}

resource "aws_dynamodb_table" "web_form_data" {
  name         = "web_form_data"
  billing_mode = "PAY_PER_REQUEST"
  hash_key     = "id"

  attribute {
    name = "id"
    type = "S"
  }
}

resource "aws_iam_role" "lambda_role" {
  name = "lambda_execution_role"

  assume_role_policy = jsonencode({
    Statement = [{
      Action = "sts:AssumeRole"
      Effect = "Allow"
      Principal = {
        Service = "lambda.amazonaws.com"
      }
    }]
    Version = "2012-10-17"
  })

  managed_policy_arns = [
    "arn:aws:iam::aws:policy/AWSLambdaExecute",
    "arn:aws:iam::aws:policy/AmazonDynamoDBFullAccess"
  ]
}

resource "aws_lambda_function" "web_lambda" {
  function_name = "web_lambda"
  role          = aws_iam_role.lambda_role.arn
  runtime       = "python3.9"
  handler       = "lambda_function.lambda_handler"

  filename         = "lambda_function.zip"
  source_code_hash = filebase64sha256("lambda_function.zip")

  environment {
    variables = {
      DYNAMODB_TABLE = aws_dynamodb_table.web_form_data.name
    }
  }
}

resource "aws_lambda_function_url" "lambda_url" {
  function_name      = aws_lambda_function.web_lambda.function_name
  authorization_type = "NONE"
}

output "lambda_function_url" {
  value = aws_lambda_function_url.lambda_url.function_url
}
```
- **Save the file (`Ctrl + X`, then `Y`, then `Enter`)**.

---

## **4Ô∏è‚É£ Create & Package the AWS Lambda Function**
Run:

```sh
nano lambda_function.py
```

Paste the **Lambda function code**:

```python
import json
import boto3
import os
import uuid

dynamodb = boto3.resource("dynamodb")
table = dynamodb.Table(os.environ["DYNAMODB_TABLE"])

def lambda_handler(event, context):
    query_params = event.get("queryStringParameters", {})

    if query_params:
        # Generate a unique ID and store data in DynamoDB
        data_id = str(uuid.uuid4())
        table.put_item(
            Item={"id": data_id, "name": query_params.get("name", "N/A"), "email": query_params.get("email", "N/A")}
        )

        return {
            "statusCode": 200,
            "headers": {"Content-Type": "text/html"},
            "body": f"<html><body><h2>Data Submitted Successfully!</h2></body></html>"
        }
    
    # Retrieve all records from DynamoDB
    response = table.scan()
    items = response.get("Items", [])

    # Generate HTML output
    html_content = "<html><body><h2>Submitted Data:</h2><ul>"
    for item in items:
        html_content += f"<li>Name: {item['name']}, Email: {item['email']}</li>"
    html_content += "</ul></body></html>"

    return {
        "statusCode": 200,
        "headers": {"Content-Type": "text/html"},
        "body": html_content
    }
```

- **Save the file (`Ctrl + X`, then `Y`, then `Enter`)**.

### **Package the Lambda function:**
```sh
zip lambda_function.zip lambda_function.py
```

---

## **5Ô∏è‚É£ Deploy Using Terraform**
Run:

```sh
terraform init
terraform apply -auto-approve
```

### **Get Lambda Function URL**
Once Terraform completes, it will output the **Lambda function URL**.

---

## **6Ô∏è‚É£ Create an HTML Form**
Run:

```sh
nano index.html
```

Paste the following:

```html
<!DOCTYPE html>
<html>
<head>
    <title>Lambda Web Form</title>
</head>
<body>
    <h2>Submit Your Details</h2>
    <form action="<LambdaFunctionURL>" method="GET">
        Name: <input type="text" name="name"><br>
        Email: <input type="email" name="email"><br>
        <input type="submit" value="Submit">
    </form>
</body>
</html>
```
- **Replace `<LambdaFunctionURL>`** with the Terraform output.

---

## **7Ô∏è‚É£ Check Data in DynamoDB**
To verify stored data, run:

```sh
aws dynamodb scan --table-name web_form_data
```

---

## **8Ô∏è‚É£ Optional: Host the Form on S3**
If CloudShell doesn't allow local preview, upload the form to **Amazon S3**:

### **Create an S3 Bucket**
```sh
aws s3 mb s3://my-lambda-web-form --region us-east-1
```

### **Upload the HTML File**
```sh
aws s3 cp index.html s3://my-lambda-web-form/
```

### **Make the File Public**
```sh
aws s3api put-object-acl --bucket my-lambda-web-form --key index.html --acl public-read
```

### **Access the Form**
```sh
echo "https://my-lambda-web-form.s3.amazonaws.com/index.html"
```

---

## **üéØ Summary**
‚úÖ Created AWS Lambda Function  
‚úÖ Integrated with DynamoDB  
‚úÖ Hosted Web Form  
‚úÖ Verified Data in DynamoDB  

---